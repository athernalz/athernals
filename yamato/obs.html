<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>yamatosdeath OBS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<style>
    body { margin:0; background:transparent; }
</style>
</head>
<body>
<script src="./chatlib.min.js?v=9"></script>
<script>
const CHANNEL = "yamatosdeath";
const cricket = new Audio("crickets.sfx");
let cooldown = false;
let streak = 0;

// Volume from URL
const urlParams = new URLSearchParams(window.location.search);
const volume = parseFloat(urlParams.get("vol")) || 0.7;
cricket.volume = volume;

const tokenMatch = window.location.hash.match(/access_token=([^&]+)/);
const token = tokenMatch ? tokenMatch[1] : localStorage.getItem("tw_token");

if (token) {
    localStorage.setItem("tw_token", token);

    const client = new tmi.Client({
        options: { debug: false },
        connection: { secure: true, reconnect: true },
        identity: { username: "justinfan" + Math.floor(Math.random()*80000), password: "oauth:" + token },
        channels: []
    });

    client.connect().then(() => {
        client.join(CHANNEL);
    });

    client.on("message", (ch, tags, msg, self) => {
        if (self) return;
        if (msg.trim() === "...") {
            streak++;
            if (streak >= 3 && !cooldown) {
                cricket.play();
                console.log("played sound");
                cooldown = true;
                setTimeout(() => cooldown = false, 10000);
                streak = 0;
            }
        } else {
            streak = 0;
        }
    });
}
</script>
</body>
</html>
