<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YamatosDeath</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="chatlib.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex items-center justify-center h-screen relative">
    <!-- Updated version tracker -->
    <div class="absolute bottom-4 left-4 text-xs text-gray-500">
        v0.0.5
    </div>

    <div class="text-center p-8 bg-gray-800 rounded-lg shadow-xl space-y-6">
        <div>
            <p class="text-lg text-gray-400 mb-2">Listening to channels: <span id="channel-display" class="font-mono text-green-400"></span></p>
        </div>
        
        <!-- Crickets Status -->
        <div class="bg-gray-700 p-4 rounded-md">
            <p class="text-sm font-bold text-gray-300">Crickets Trigger ("...")</p>
            <div id="crickets-status" class="text-2xl font-semibold">Waiting for messages...</div>
        </div>

        <!-- Sitcom Laugh Status -->
        <div class="bg-gray-700 p-4 rounded-md">
            <p class="text-sm font-bold text-gray-300">Sitcom Laugh Trigger ("LOL", "LO", "KLO")</p>
            <div id="sitcom-status" class="text-2xl font-semibold">Waiting for messages...</div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const channelNames = ['yamatosdeath', 'athernals7'];
        const triggerCount = 3;
        const cooldownDuration = 10000; // 10 seconds in milliseconds

        const cricketTrigger = '...';
        const sitcomTriggers = ['LOL', 'LO', 'KLO'];
        // ---------------------

        const channelDisplayElement = document.getElementById('channel-display');
        const cricketsStatusElement = document.getElementById('crickets-status');
        const sitcomStatusElement = document.getElementById('sitcom-status');

        let cricketConsecutiveCount = 0;
        let sitcomConsecutiveCount = 0;
        let cricketsOnCooldown = false;
        let sitcomOnCooldown = false;

        channelDisplayElement.textContent = channelNames.join(', ');

        function updateCricketsStatus() {
            if (cricketsOnCooldown) {
                cricketsStatusElement.textContent = 'On Cooldown...';
                cricketsStatusElement.classList.add('text-yellow-400');
            } else {
                cricketsStatusElement.textContent = `Count: ${cricketConsecutiveCount} / ${triggerCount}`;
                cricketsStatusElement.classList.remove('text-yellow-400');
            }
        }

        function updateSitcomStatus() {
            if (sitcomOnCooldown) {
                sitcomStatusElement.textContent = 'On Cooldown...';
                sitcomStatusElement.classList.add('text-yellow-400');
            } else {
                sitcomStatusElement.textContent = `Count: ${sitcomConsecutiveCount} / ${triggerCount}`;
                sitcomStatusElement.classList.remove('text-yellow-400');
            }
        }

        function playSound(soundFile) {
            console.log(`Attempting to play sound: ${soundFile}`);
            const audio = new Audio(`${soundFile}.mp3`);
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => console.error(`Audio playback failed for ${soundFile}:`, error));
            }
        }

        const client = new tmi.Client({ channels: channelNames });
        client.connect().catch(console.error);

        client.on('message', (channel, tags, message, self) => {
            if (self) return;

            const trimmedMessage = message.trim();
            const upperCaseMessage = trimmedMessage.toUpperCase();

            if (trimmedMessage.startsWith(cricketTrigger)) {
                cricketConsecutiveCount++;
                sitcomConsecutiveCount = 0; // Reset other counter
            } else if (sitcomTriggers.includes(upperCaseMessage)) {
                sitcomConsecutiveCount++;
                cricketConsecutiveCount = 0; // Reset other counter
            } else {
                // Reset both if message is not a trigger
                cricketConsecutiveCount = 0;
                sitcomConsecutiveCount = 0;
            }

            // Check for Cricket trigger activation
            if (cricketConsecutiveCount >= triggerCount && !cricketsOnCooldown) {
                playSound('crickets');
                cricketsOnCooldown = true;
                cricketConsecutiveCount = 0;
                setTimeout(() => {
                    cricketsOnCooldown = false;
                    updateCricketsStatus();
                }, cooldownDuration);
            }

            // Check for Sitcom trigger activation
            if (sitcomConsecutiveCount >= triggerCount && !sitcomOnCooldown) {
                playSound('sitcom');
                sitcomOnCooldown = true;
                sitcomConsecutiveCount = 0;
                setTimeout(() => {
                    sitcomOnCooldown = false;
                    updateSitcomStatus();
                }, cooldownDuration);
            }

            updateCricketsStatus();
            updateSitcomStatus();
        });
        
        // Initial UI update
        updateCricketsStatus();
        updateSitcomStatus();
    </script>
</body>
</html>
